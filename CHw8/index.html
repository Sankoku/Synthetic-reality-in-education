<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <title>MindAR Face Tracking - 468 Blue Spheres</title>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.4/dist/mindar-face-three.prod.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #000;
            color: white;
        }
        
        /* üëá –ò–ó–ú–ï–ù–ï–ù–ò–ï: –î–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
        #container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            z-index: -2; /* –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –æ–Ω –∑–∞ –≤—Å–µ–º */
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 20px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            font-size: 18px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button id="startBtn" class="btn" onclick="start()">–ü–æ—á–∞—Ç–∏ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è</button>
        <button id="stopBtn" class="btn" onclick="stop()" disabled>–ó—É–ø–∏–Ω–∏—Ç–∏</button>
        <button id="toggleVideoBtn" class="btn" onclick="toggleVideo()" disabled>–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –≤—ñ–¥–µ–æ</button>
    </div>
    
    <div class="status" id="status">
        –ì–æ—Ç–æ–≤–∏–π –¥–æ –∑–∞–ø—É—Å–∫—É
    </div>
    
    <div class="loading" id="loading">
        –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ...
    </div>

    <div id="container"></div>

    <script>
        const THREE = window.MINDAR.FACE.THREE;
        
        let startBtn, stopBtn, toggleVideoBtn, status, loading;
        
        let mindarThree = null;
        let anchors = [];
        let isStarted = false;
        let videoHidden = false;
        
        window.addEventListener('DOMContentLoaded', () => {
            startBtn = document.getElementById('startBtn');
            stopBtn = document.getElementById('stopBtn');
            toggleVideoBtn = document.getElementById('toggleVideoBtn');
            status = document.getElementById('status');
            loading = document.getElementById('loading');
            
            updateStatus('–ì–æ—Ç–æ–≤–∏–π –¥–æ –∑–∞–ø—É—Å–∫—É - –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–æ—á–∞—Ç–∏ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è"');
            console.log('MindAR Face Tracking –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–±–æ—Ç–∏');
            console.log('–ë—É–¥–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ 468 —Å–∏–Ω—ñ—Ö —Å—Ñ–µ—Ä –¥–ª—è –≤—Å—ñ—Ö –æ–ø–æ—Ä–Ω–∏—Ö —Ç–æ—á–æ–∫ –æ–±–ª–∏—á—á—è');
        });
        
        function updateStatus(message) {
            if (status) {
                status.textContent = message;
            }
            console.log(message);
        }
        
        async function start() {
            try {
                updateStatus('–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è...');
                loading.style.display = 'block';
                startBtn.disabled = true;
                
                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è MindAR –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏ –¥–ª—è –∫—Ä–∞—â–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
                mindarThree = new window.MINDAR.FACE.MindARThree({
                    // üëá –ò–ó–ú–ï–ù–ï–ù–ò–ï: –£–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—à –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–º–µ—Å—Ç–æ document.body
                    container: document.querySelector("#container"),
                    uiLoading: "no",
                    uiScanning: "no",
                    uiError: "no",
                });
                
                const {renderer, scene, camera} = mindarThree;
                
                updateStatus('–°—Ç–≤–æ—Ä–µ–Ω–Ω—è 468 –æ–ø–æ—Ä–Ω–∏—Ö —Ç–æ—á–æ–∫...');
                
                anchors = [];
                for(let i = 0; i < 468; i++) {
                    const geometry = new THREE.SphereGeometry(0.008, 16, 12);
                    const material = new THREE.MeshBasicMaterial({
                        color: 0x0066ff,
                        transparent: true,
                        opacity: 0.8
                    });
                    const sphere = new THREE.Mesh(geometry, material);
                    
                    const anchor = mindarThree.addAnchor(i);
                    anchor.group.add(sphere);
                    anchors.push(anchor);
                    
                    if (i % 50 === 0) {
                        updateStatus(`–°—Ç–≤–æ—Ä–µ–Ω–æ ${i + 1}/468 —Ç–æ—á–æ–∫...`);
                        await new Promise(resolve => setTimeout(resolve, 10));
                    }
                }
                
                updateStatus('–ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä–∏...');
                
                await mindarThree.start();

                // üëá –ò–ó–ú–ï–ù–ï–ù–ò–ï: –≠—Ç–æ—Ç –±–ª–æ–∫ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω, —Ç–∞–∫ –∫–∞–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–∞–º–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç —Ä–∞–∑–º–µ—Ä–∞–º–∏.
                // –Ø –µ–≥–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª, –Ω–æ –º–æ–∂–Ω–æ –∏ —É–¥–∞–ª–∏—Ç—å.
                /*
                if (mindarThree.video) {
                    mindarThree.video.style.position = 'fixed';
                    mindarThree.video.style.top = '0';
                    mindarThree.video.style.left = '0';
                    mindarThree.video.style.width = '100vw';
                    mindarThree.video.style.height = '100vh';
                    mindarThree.video.style.objectFit = 'cover';
                    mindarThree.video.style.zIndex = '-1';
                }
                */
                
                updateStatus(`–í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–µ (${anchors.length} —Ç–æ—á–æ–∫)`);
                loading.style.display = 'none';
                
                startBtn.disabled = true;
                stopBtn.disabled = false;
                toggleVideoBtn.disabled = false;
                isStarted = true;
                
                renderer.setAnimationLoop(() => {
                    renderer.render(scene, camera);
                });
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É:', error);
                updateStatus('–ü–æ–º–∏–ª–∫–∞: ' + error.message);
                loading.style.display = 'none';
                startBtn.disabled = false;
            }
        }
        
        async function stop() {
            try {
                if (mindarThree && isStarted) {
                    updateStatus('–ó—É–ø–∏–Ω–∫–∞...');
                    await mindarThree.stop();
                    
                    anchors.forEach(anchor => {
                        if (anchor.group) {
                            anchor.group.clear();
                        }
                    });
                    anchors = [];
                    
                    mindarThree = null;
                    isStarted = false;
                    videoHidden = false;
                    
                    updateStatus('–ó—É–ø–∏–Ω–µ–Ω–æ');
                    
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                    toggleVideoBtn.disabled = true;
                    toggleVideoBtn.textContent = '–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –≤—ñ–¥–µ–æ';
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑—É–ø–∏–Ω—Ü—ñ:', error);
                updateStatus('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑—É–ø–∏–Ω—Ü—ñ');
            }
        }
        
        function toggleVideo() {
            if (mindarThree && mindarThree.video) {
                if (videoHidden) {
                    mindarThree.video.style.visibility = "visible";
                    toggleVideoBtn.textContent = '–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –≤—ñ–¥–µ–æ';
                    videoHidden = false;
                    updateStatus('–í—ñ–¥–µ–æ –ø–æ–∫–∞–∑–∞–Ω–æ');
                } else {
                    mindarThree.video.style.visibility = "hidden";
                    toggleVideoBtn.textContent = '–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—ñ–¥–µ–æ';
                    videoHidden = true;
                    updateStatus('–í—ñ–¥–µ–æ –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ (—Ç—ñ–ª—å–∫–∏ —Å—Ñ–µ—Ä–∏)');
                }
            }
        }
        
        window.addEventListener('error', (event) => {
            console.error('–ì–ª–æ–±–∞–ª—å–Ω–∞ –ø–æ–º–∏–ª–∫–∞:', event.error);
            updateStatus('–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞');
            if (loading) loading.style.display = 'none';
            if (startBtn) startBtn.disabled = false;
        });
    </script>
</body>
</html>